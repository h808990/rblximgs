<!DOCTYPE html>
<html>
<head>
    <title>Simple GitHub Uploader</title>
</head>
<body>

    <h2>GitHub Image Uploader</h2>

    <label>Your GitHub Token:</label><br>
    <input id="token" type="password" style="width:300px;"><br><br>

    <label>Image URL:</label><br>
    <input id="imageUrl" type="text" style="width:300px;"><br><br>

    <button onclick="uploadImage()">Upload Image</button>
    <button onclick="copyLastLink()">Copy Link</button>

    <h3>Your Uploaded Images</h3>
    <div id="uploadedList"></div>

<script>
// ------- SETTINGS -------
const USERNAME = "YOUR_USERNAME_HERE";
const REPO     = "YOUR_REPO_HERE";
const PATH     = "images"; // folder inside repo

// ------- MAIN UPLOAD FUNCTION -------
async function uploadImage() {
    const token = document.getElementById("token").value.trim();
    const imageUrl = document.getElementById("imageUrl").value.trim();

    if (!token || !imageUrl) {
        alert("Missing token or image URL");
        return;
    }

    const fileName = "img_" + Date.now() + ".png";

    // Get image as blob â†’ base64 encode
    const blob = await fetch(imageUrl).then(r => r.blob());
    const arrayBuffer = await blob.arrayBuffer();
    const base64 = btoa(
        new Uint8Array(arrayBuffer).reduce((data, byte) => data + String.fromCharCode(byte), "")
    );

    const uploadURL = `https://api.github.com/repos/${USERNAME}/${REPO}/contents/${PATH}/${fileName}`;

    const response = await fetch(uploadURL, {
        method: "PUT",
        headers: {
            "Authorization": "Bearer " + token,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            message: "Upload image",
            content: base64
        })
    });

    const result = await response.json();

    if (result.content && result.content.download_url) {
        const finalLink = result.content.download_url;

        // Save last link
        localStorage.setItem("lastUploaded", finalLink);

        // Add to list
        addToList(finalLink);
    } else {
        alert("Upload failed. Check token repo permissions.");
    }
}

// ------- COPY LAST LINK -------
function copyLastLink() {
    const last = localStorage.getItem("lastUploaded");
    if (!last) {
        alert("No uploaded link to copy yet.");
        return;
    }

    navigator.clipboard.writeText(last);
    alert("Copied: " + last);
}

// ------- ADD LINK TO LIST -------
function addToList(url) {
    const div = document.getElementById("uploadedList");
    const item = document.createElement("div");
    item.innerHTML = `<a href="${url}" target="_blank">${url}</a>`;
    div.prepend(item);
}
</script>

</body>
</html>
