<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Roblox → GitHub Image Uploader</title>
<style>
body { background:#0d0d0d; color:#fff; font-family:Arial; padding:25px; }
h2 { margin-bottom:10px; }
.box { background:#1b1b1b; padding:20px; border-radius:10px; max-width:600px; margin:auto; }
input, button { width:100%; margin-top:10px; padding:10px; border-radius:6px; border:none; font-size:16px; }
button { background:#4CAF50; color:white; cursor:pointer; }
button:hover { opacity:0.8; }
#output { margin-top:20px; word-break:break-all; }
</style>
</head>
<body>

<div class="box">
<h2>Roblox → GitHub Image Uploader</h2>

<label>Your GitHub Token (local only)</label>
<input type="password" id="token" placeholder="Paste your token here">

<label>Upload Local Image</label>
<input type="file" id="fileInput" accept="image/*">

<label>OR paste a Roblox image URL</label>
<input type="text" id="robloxUrl" placeholder="https://tr.rbxcdn.com/...">

<label>Optional filename</label>
<input type="text" id="filename" placeholder="Leave empty for auto-name">

<button onclick="startUpload()">Upload</button>

<div id="output">Status: Waiting...</div>
</div>

<script>
const owner = "h808990";
const repo  = "rblximgs";

async function startUpload() {
    const token = document.getElementById("token").value.trim();
    const localFile = document.getElementById("fileInput").files[0];
    const robloxUrl = document.getElementById("robloxUrl").value.trim();

    if (!token) return show("❌ Error: Missing GitHub token");

    if (localFile) return uploadLocal(token, localFile);
    if (robloxUrl) return uploadRoblox(token, robloxUrl);

    show("❌ Error: Select a file or paste a Roblox link");
}

function show(msg) {
    document.getElementById("output").innerHTML = msg;
}

async function uploadRoblox(token, url){
    show("Downloading Roblox image...");

    try {
        const resp = await fetch(url);
        if (!resp.ok) return show("❌ Could not download Roblox image");

        const blob = await resp.blob();
        const file = new File([blob], "roblox.webp", { type: blob.type });

        uploadLocal(token, file);
    } catch (err) {
        show("❌ Roblox download error: " + err);
    }
}

async function uploadLocal(token, file){
    const fnameInput = document.getElementById("filename").value.trim();
    const ext = file.name.split('.').pop();
    const fname = fnameInput || `img_${Date.now()}.${ext}`;

    show("Converting to Base64...");
    const base64 = await toBase64(file);

    show("Reading repo branch...");
    const repoData = await fetch(`https://api.github.com/repos/${owner}/${repo}`)
        .then(r=>r.json());
    const branch = repoData.default_branch || "main";

    show("Uploading to GitHub...");
    const uploadUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(fname)}`;

    const response = await fetch(uploadUrl, {
        method: "PUT",
        headers: {
            "Authorization": `Bearer ${token}`,
            "Accept": "application/vnd.github+json",
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            message:`Upload ${fname}`,
            content: base64
        })
    });

    const data = await response.json();

    if (!response.ok) {
        return show("❌ Upload failed:<br>" + JSON.stringify(data, null, 2));
    }

    const raw = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${encodeURIComponent(fname)}`;

    show(`✅ Uploaded!<br><br>Permanent Raw URL:<br><a href="${raw}" target="_blank">${raw}</a>`);
}

function toBase64(file){
    return new Promise((res, rej)=>{
        const reader = new FileReader();
        reader.onload = ()=>res(reader.result.split(',')[1]);
        reader.onerror = err=>rej(err);
        reader.readAsDataURL(file);
    });
}
</script>

</body>
</html>
